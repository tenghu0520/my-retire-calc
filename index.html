<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€ä¼‘è©¦ç®—èˆ‡è³‡ç”¢é…ç½®æ¨¡æ“¬å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5 md:p-10">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-md">
        <h2 class="text-2xl font-bold mb-6 text-gray-800 text-center">é€€ä¼‘è©¦ç®—èˆ‡è³‡ç”¢é…ç½®æ¨¡æ“¬å™¨ (3% è¦å‰‡)</h2>
        
        <div class="mb-8">
            <label class="block text-sm font-bold text-gray-700 mb-3">å¿«æ·è³‡ç”¢é…ç½®æ¨¡æ“¬ï¼š</label>
            <div class="grid grid-cols-3 gap-2">
                <button onclick="setAllocation(0.1, 'ç©æ¥µå‹ (å…¨è‚¡ç¥¨)')" class="text-xs bg-red-100 hover:bg-red-200 text-red-700 py-2 rounded border border-red-200 transition">ç©æ¥µå‹<br>(å ±é…¬ 10%)</button>
                <button onclick="setAllocation(0.07, 'ç©©å¥å‹ (è‚¡å‚µå¹³è¡¡)')" class="text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 py-2 rounded border border-blue-200 transition">ç©©å¥å‹<br>(å ±é…¬ 7%)</button>
                <button onclick="setAllocation(0.04, 'ä¿å®ˆå‹ (å¤šå‚µå°‘è‚¡)')" class="text-xs bg-green-100 hover:bg-green-200 text-green-700 py-2 rounded border border-green-200 transition">ä¿å®ˆå‹<br>(å ±é…¬ 4%)</button>
            </div>
            <p id="allocationHint" class="text-center text-xs text-gray-500 mt-2">é»æ“Šä¸Šæ–¹æŒ‰éˆ•å¯å¿«é€Ÿå¸¶å…¥åƒè€ƒå ±é…¬ç‡</p>
        </div>

        <hr class="mb-8">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">é€šè†¨ç‡ (é æœŸç‰©åƒ¹æ¼²å¹…)</label>
                <input id="C2" type="number" value="0.02" step="0.01" oninput="updateRealRate()" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 shadow-sm">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">æŠ•è³‡å¹´å ±é…¬ç‡ (é•·æœŸå¹³å‡)</label>
                <input id="D2" type="number" value="0.08" step="0.01" oninput="updateRealRate()" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 shadow-sm">
            </div>
            <div class="md:col-span-2 bg-gray-50 p-3 rounded-lg flex justify-between items-center border border-gray-200">
                <span class="text-sm font-medium text-gray-600">é ä¼°å¯¦è³ªå ±é…¬ç‡ (æ‰£é™¤é€šè†¨å¾Œ)ï¼š</span>
                <span id="realRateDisplay" class="text-lg font-bold">--</span>
            </div>
            <div><label class="block text-sm font-medium text-gray-700">ä»Šå¹´åº¦ç”Ÿæ´»è²» (ç¸½æ”¯å‡º)</label><input id="E2" type="number" value="1000000" class="w-full border p-2 rounded"></div>
            <div><label class="block text-sm font-medium text-gray-700">æ¯å¹´è¨ˆç•«æŠ•å…¥é‡‘é¡</label><input id="F2" type="number" value="1000000" class="w-full border p-2 rounded"></div>
            <div><label class="block text-sm font-medium text-gray-700">ç›®å‰å¹´é½¡</label><input id="H2" type="number" value="40" class="w-full border p-2 rounded"></div>
            <div><label class="block text-sm font-medium text-gray-700">ç›®å‰ç¸½è³‡ç”¢</label><input id="ETF_K3" type="number" value="2000000" class="w-full border p-2 rounded"></div>
        </div>

        <button onclick="calculate()" class="w-full mt-8 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 shadow-lg">é–‹å§‹è¨ˆç®—</button>

        <div id="result" class="mt-8 p-6 bg-blue-50 border border-blue-200 text-blue-800 rounded-xl hidden shadow-inner">
            <div class="text-center">
                <span class="text-xl">é è¨ˆé€€ä¼‘å¹´é½¡ç‚ºï¼š</span>
                <div class="mt-2"><span id="retireAge" class="text-5xl font-extrabold text-blue-600">--</span> <span class="text-2xl font-bold">æ­²</span></div>
            </div>
            <div class="mt-6 pt-6 border-t border-blue-200 grid grid-cols-1 gap-4 text-center">
                <div>
                    <p class="text-sm text-gray-600">é€€ä¼‘æ™‚æ‰€éœ€è³‡ç”¢ (è€ƒæ…®é€šè†¨å¾Œ)</p>
                    <p id="retireFund" class="text-2xl font-bold text-gray-800">--</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">é€€ä¼‘é¦–å¹´é ä¼°ç”Ÿæ´»è²»</p>
                    <p id="retireExpense" class="text-xl font-semibold text-gray-700">--</p>
                </div>
            </div>
        </div>

        <hr class="my-10 border-gray-200">

        <div class="text-sm text-gray-600 leading-relaxed">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center text-blue-600">
                ç­–ç•¥å»ºè­°èˆ‡è³‡ç”¢é…ç½®è§€å¿µ
            </h3>
            
            <div class="space-y-6">
                
                <section>
                    <p class="font-bold text-gray-800 text-base mb-1 text-red-600">1. é…ç½®èˆ‡å ±é…¬çš„æ¬Šè¡¡</p>
                    <p>æ­·å²æ•¸æ“šé¡¯ç¤ºï¼Œå…¨è‚¡ç¥¨é…ç½®(ç©æ¥µå‹)é•·æœŸå¹´åŒ–å ±é…¬ç´„ 10%ï¼Œä½†éç¨‹ä¸­å¯èƒ½é¢è‡¨ 30-50% çš„å›æ’¤ã€‚ç©©å¥å‹(60/40 è‚¡å‚µé…ç½®)å‰‡èƒ½å°‡æ³¢å‹•é™è‡³ 15-20%ï¼Œä¸¦æä¾›ç´„ 7% å ±é…¬ã€‚é¸æ“‡é©åˆæ‚¨å¿ƒç†ç´ è³ªçš„é…ç½®ï¼Œæ˜¯ææ—©é€€ä¼‘çš„é—œéµã€‚</p>
                </section>

                <section>
                    <p class="font-bold text-gray-800 text-base mb-1">2. ç‚ºä»€éº¼é¸æ“‡ 3% è¦å‰‡ï¼Ÿ</p>
                    <p>ç›¸å°æ–¼å‚³çµ± 4% è¦å‰‡ï¼Œ3% è¦å‰‡èƒ½æ›´æœ‰æ•ˆæ‡‰å°ææ—©é€€ä¼‘å¯èƒ½é•·é” 50 å¹´çš„æé ˜æœŸï¼Œä¸¦åœ¨æ‰£é™¤é€šè†¨å¾Œï¼Œæ¥µå¤§åŒ–ã€Œä¸å‹•ç”¨æœ¬é‡‘ã€çš„æ©Ÿç‡ã€‚</p>
                </section>

                <section class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <p class="font-bold text-blue-800 text-base mb-1">ğŸ’¡ ææ—©é€€ä¼‘å»ºè­°</p>
                    <ul class="list-disc ml-5 space-y-2 text-blue-700">
                        <li><span class="font-semibold">å‹•æ…‹å®šæŠ•ï¼š</span>è‹¥æ‚¨çš„å®šæŠ•é‡‘é¡éš¨è–ªè³‡åŒæ­¥èª¿å‡ï¼Œå¯¦éš›é€€ä¼‘æ™‚é–“å¯èƒ½æœƒå¤§å¹…ææ—©ã€‚</li>
                        <li><span class="font-semibold">ç¾é‡‘ç·©è¡ï¼š</span>é€€ä¼‘æ™‚å»ºè­°ä¿ç•™ 2-3 å¹´ç”Ÿæ´»è²»ç¾é‡‘ï¼Œé¿å…åœ¨è‚¡å¸‚å¤§è·Œæ™‚è®Šè³£éƒ¨ä½ã€‚</li>
                    </ul>
                </section>
            </div>
        </div>
    </div>

    <script>
        // å¿«æ·é…ç½®åˆ‡æ›
        function setAllocation(rate, label) {
            document.getElementById('D2').value = rate;
            document.getElementById('allocationHint').innerText = "ç•¶å‰å·²å¥—ç”¨ï¼š" + label;
            updateRealRate();
            calculate(); // è‡ªå‹•é‡æ–°è¨ˆç®—
        }

        function updateRealRate() {
            const inflation = parseFloat(document.getElementById('C2').value) || 0;
            const returnRate = parseFloat(document.getElementById('D2').value) || 0;
            const realRate = (returnRate - inflation) * 100;
            
            const display = document.getElementById('realRateDisplay');
            display.innerText = realRate.toFixed(1) + "%";
            
            if (realRate > 0) {
                display.className = "text-lg font-bold text-green-600";
            } else if (realRate < 0) {
                display.className = "text-lg font-bold text-red-600";
            } else {
                display.className = "text-lg font-bold text-gray-600";
            }
        }

        function RetireYearSol(C2, D2, E2, F2, H2, ETF_K3) {
            var withdrawRate = 0.03; 
            var A2 = H2;
            var maxAge = 100;
            var step = 0.1;
            var guard = 0;

            while (true) {
                var n = A2 - H2;
                var currentExpense = E2 * Math.pow(1 + C2, n); 
                var Need = currentExpense / withdrawRate;      
                
                var cash_ret = ETF_K3 * Math.pow(1 + D2, n);
                var inv_ret = (D2 === 0) ? F2 * n : F2 * (1 + D2) * (Math.pow(1 + D2, n) - 1) / D2;
                var save = (cash_ret + inv_ret);

                if (save >= Need) {
                    return {
                        age: A2.toFixed(1),
                        totalSave: Math.round(save),
                        expense: Math.round(currentExpense)
                    };
                }

                A2 += step;
                guard++;
                if (A2 > maxAge || guard > 2000) return null;
            }
        }

        function calculate() {
            const data = RetireYearSol(
                parseFloat(document.getElementById('C2').value),
                parseFloat(document.getElementById('D2').value),
                parseFloat(document.getElementById('E2').value),
                parseFloat(document.getElementById('F2').value),
                parseFloat(document.getElementById('H2').value),
                parseFloat(document.getElementById('ETF_K3').value)
            );

            const resultDiv = document.getElementById('result');
            if (data) {
                resultDiv.classList.remove('hidden');
                document.getElementById('retireAge').innerText = data.age;
                document.getElementById('retireFund').innerText = "NT$ " + data.totalSave.toLocaleString();
                document.getElementById('retireExpense').innerText = "NT$ " + data.expense.toLocaleString() + " / å¹´";
            } else {
                resultDiv.classList.remove('hidden');
                document.getElementById('retireAge').innerText = "ç„¡æ³•é”æˆ";
                document.getElementById('retireFund').innerText = "--";
                document.getElementById('retireExpense').innerText = "--";
            }
        }

        window.onload = updateRealRate;
    </script>
</body>
</html>
